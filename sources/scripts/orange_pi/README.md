# Сборка для Orange Pi 5 Plus (ARM64)

Данная директория содержит скрипты для сборки проекта Linia на одноплатном компьютере Orange Pi 5 Plus с процессором RK3588 (ARM64) под управлением Ubuntu 24.04 и KDE Neon Plasma.

## Исправленные проблемы

1. **Архитектурные зависимости**: Убраны жестко зашитые пути к x86_64 библиотекам
2. **MSVC флаги**: Отключены MSVC-специфичные флаги компилятора для Linux
3. **Автоматическое определение архитектуры**: Добавлено автоматическое определение ARM64/aarch64
4. **Улучшенный поиск библиотек**: Используется find_library() с fallback на архитектурно-специфичные пути
5. **WebKit2GTK совместимость**: Автоматическое определение версии WebKit2GTK для Ubuntu 24.04 (4.1) и старших версий (4.0)

## Последовательность сборки

### 1. Установка зависимостей
```bash
cd sources/scripts/orange_pi
chmod +x install_soft_arm64.sh
./install_soft_arm64.sh
```

### 2. Полная сборка проекта
```bash
chmod +x full_build_arm64.sh
./full_build_arm64.sh
```

### 3. Запуск приложения

⚠️ **Важно**: Linia2 - это GUI приложение, требующее графическое окружение!

#### Проверка готовности системы:
```bash
chmod +x diagnose_gui.sh
./diagnose_gui.sh
```

#### Автоматический запуск с настройкой дисплея:
```bash
chmod +x run_with_display.sh
./run_with_display.sh
```

#### Ручной запуск:
```bash
cd ../../generated/Linia2
./Linia2
```

#### Если возникает ошибка "Unable to initialize GTK+":

1. **Для локального запуска**: войдите в графическую сессию KDE
2. **Для SSH подключения**:
   ```bash
   ssh -X пользователь@orangepi_ip
   # или для trusted connections:
   ssh -Y пользователь@orangepi_ip
   ```
3. **Для VNC**: установите VNC сервер для удаленного доступа к рабочему столу
4. **Виртуальный дисплей** (для headless серверов):
   ```bash
   sudo apt install xvfb
   export DISPLAY=:99
   Xvfb :99 -screen 0 1024x768x16 &
   cd ../../generated/Linia2 && ./Linia2
   ```

## Устранение проблем

### Ошибка линковки с GSpell
Если при сборке основного проекта возникают ошибки типа:
```
undefined reference to `gspell_text_view_get_from_gtk_text_view'
```

Выполните:
```bash
chmod +x fix_packages_arm64.sh
./fix_packages_arm64.sh
```

### Ошибка сборки основного проекта
Если сборка не удалась после успешной сборки wxWidgets:
```bash
chmod +x fix_build_arm64.sh
./fix_build_arm64.sh
```

## Особенности ARM64 сборки

- Используется флаг `-march=armv8-a` для оптимизации под ARM64
- Автоматическое определение путей к библиотекам для aarch64
- Поддержка нескольких архитектур в одном CMakeLists.txt
- Отладочная информация о найденных библиотеках

## Проверка архитектуры

Скрипты автоматически определяют архитектуру системы и выводят предупреждения при несоответствии.

## Требования к системе

- Ubuntu 24.04 (или совместимая)
- KDE Neon Plasma
- ARM64/aarch64 архитектура
- Минимум 4 ГБ ОЗУ для сборки
- 2 ГБ свободного места на диске
